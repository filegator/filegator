<?php
/**
 * Trend Micro Vision One File Security SDK for PHP
 *
 * @package TrendAndrew\FileSecurity
 * @license MIT
 */

namespace TrendAndrew\FileSecurity\Model;

/**
 * Represents a detected malware from scan results
 *
 * Contains information about a detected threat including:
 * - Malware name/identifier
 * - Malware type/category
 * - Filter information
 */
class Malware
{
    /**
     * @var string Malware name/identifier
     */
    private string $malwareName;

    /**
     * @var string File name associated with the malware
     */
    private string $fileName;

    /**
     * @var string|null Malware type/category
     */
    private ?string $type;

    /**
     * @var string|null Filter that detected the malware
     */
    private ?string $filter;

    /**
     * @var string|null Filter description
     */
    private ?string $filterDescription;

    /**
     * Create a new Malware instance
     *
     * @param string $malwareName Malware name
     * @param string $fileName File name
     * @param string|null $type Malware type
     * @param string|null $filter Filter name
     * @param string|null $filterDescription Filter description
     */
    public function __construct(
        string $malwareName,
        string $fileName,
        ?string $type = null,
        ?string $filter = null,
        ?string $filterDescription = null
    ) {
        $this->malwareName = $malwareName;
        $this->fileName = $fileName;
        $this->type = $type;
        $this->filter = $filter;
        $this->filterDescription = $filterDescription;
    }

    /**
     * Get the malware name
     *
     * @return string
     */
    public function getMalwareName(): string
    {
        return $this->malwareName;
    }

    /**
     * Get the file name
     *
     * @return string
     */
    public function getFileName(): string
    {
        return $this->fileName;
    }

    /**
     * Get the malware type
     *
     * @return string|null
     */
    public function getType(): ?string
    {
        return $this->type;
    }

    /**
     * Get the filter name
     *
     * @return string|null
     */
    public function getFilter(): ?string
    {
        return $this->filter;
    }

    /**
     * Get the filter description
     *
     * @return string|null
     */
    public function getFilterDescription(): ?string
    {
        return $this->filterDescription;
    }

    /**
     * Convert to array
     *
     * @return array
     */
    public function toArray(): array
    {
        return [
            'malwareName' => $this->malwareName,
            'fileName' => $this->fileName,
            'type' => $this->type,
            'filter' => $this->filter,
            'filterDescription' => $this->filterDescription,
        ];
    }

    /**
     * Create Malware from API response data
     *
     * @param array $data Response data
     * @return self
     */
    public static function fromResponse(array $data): self
    {
        return new self(
            $data['malwareName'] ?? $data['malware_name'] ?? 'Unknown',
            $data['fileName'] ?? $data['file_name'] ?? '',
            $data['type'] ?? null,
            $data['filter'] ?? null,
            $data['filterDescription'] ?? $data['filter_description'] ?? null
        );
    }

    /**
     * String representation
     *
     * @return string
     */
    public function __toString(): string
    {
        return sprintf(
            "Malware: %s (Type: %s, Filter: %s)",
            $this->malwareName,
            $this->type ?? 'Unknown',
            $this->filter ?? 'Unknown'
        );
    }
}
