<?php
/**
 * Trend Micro Vision One File Security SDK for PHP - Tests
 *
 * @package TrendMicro\FileSecurity\Tests
 * @license MIT
 */

namespace TrendMicro\FileSecurity\Tests;

use PHPUnit\Framework\TestCase;
use TrendMicro\FileSecurity\Model\Malware;

/**
 * Test cases for Malware model
 */
class MalwareTest extends TestCase
{
    /**
     * Test basic malware creation
     */
    public function testBasicCreation(): void
    {
        $malware = new Malware('TestVirus', 'infected.exe');

        $this->assertEquals('TestVirus', $malware->getMalwareName());
        $this->assertEquals('infected.exe', $malware->getFileName());
        $this->assertNull($malware->getType());
        $this->assertNull($malware->getFilter());
        $this->assertNull($malware->getFilterDescription());
    }

    /**
     * Test malware creation with all parameters
     */
    public function testFullCreation(): void
    {
        $malware = new Malware(
            'EICAR-Test-File',
            'eicar.txt',
            'virus',
            'pattern',
            'Pattern-based detection'
        );

        $this->assertEquals('EICAR-Test-File', $malware->getMalwareName());
        $this->assertEquals('eicar.txt', $malware->getFileName());
        $this->assertEquals('virus', $malware->getType());
        $this->assertEquals('pattern', $malware->getFilter());
        $this->assertEquals('Pattern-based detection', $malware->getFilterDescription());
    }

    /**
     * Test fromResponse factory method
     */
    public function testFromResponse(): void
    {
        $data = [
            'malwareName' => 'Trojan.Gen',
            'fileName' => 'trojan.exe',
            'type' => 'trojan',
            'filter' => 'behavior',
            'filterDescription' => 'Behavioral analysis',
        ];

        $malware = Malware::fromResponse($data);

        $this->assertEquals('Trojan.Gen', $malware->getMalwareName());
        $this->assertEquals('trojan.exe', $malware->getFileName());
        $this->assertEquals('trojan', $malware->getType());
        $this->assertEquals('behavior', $malware->getFilter());
        $this->assertEquals('Behavioral analysis', $malware->getFilterDescription());
    }

    /**
     * Test fromResponse with snake_case keys
     */
    public function testFromResponseSnakeCase(): void
    {
        $data = [
            'malware_name' => 'Ransomware.Test',
            'file_name' => 'ransom.exe',
            'type' => 'ransomware',
            'filter_description' => 'Encryption pattern detected',
        ];

        $malware = Malware::fromResponse($data);

        $this->assertEquals('Ransomware.Test', $malware->getMalwareName());
        $this->assertEquals('ransom.exe', $malware->getFileName());
        $this->assertEquals('ransomware', $malware->getType());
        $this->assertEquals('Encryption pattern detected', $malware->getFilterDescription());
    }

    /**
     * Test fromResponse with missing data uses defaults
     */
    public function testFromResponseWithDefaults(): void
    {
        $data = [];

        $malware = Malware::fromResponse($data);

        $this->assertEquals('Unknown', $malware->getMalwareName());
        $this->assertEquals('', $malware->getFileName());
        $this->assertNull($malware->getType());
        $this->assertNull($malware->getFilter());
    }

    /**
     * Test toArray method
     */
    public function testToArray(): void
    {
        $malware = new Malware(
            'TestMalware',
            'test.exe',
            'adware',
            'signature',
            'Signature match'
        );

        $array = $malware->toArray();

        $this->assertEquals('TestMalware', $array['malwareName']);
        $this->assertEquals('test.exe', $array['fileName']);
        $this->assertEquals('adware', $array['type']);
        $this->assertEquals('signature', $array['filter']);
        $this->assertEquals('Signature match', $array['filterDescription']);
    }

    /**
     * Test toString method
     */
    public function testToString(): void
    {
        $malware = new Malware(
            'TestVirus',
            'test.exe',
            'virus',
            'pattern'
        );

        $string = (string) $malware;

        $this->assertStringContainsString('TestVirus', $string);
        $this->assertStringContainsString('virus', $string);
        $this->assertStringContainsString('pattern', $string);
    }

    /**
     * Test toString with null values
     */
    public function testToStringWithNullValues(): void
    {
        $malware = new Malware('SimpleMalware', 'file.exe');
        $string = (string) $malware;

        $this->assertStringContainsString('SimpleMalware', $string);
        $this->assertStringContainsString('Unknown', $string);
    }
}
